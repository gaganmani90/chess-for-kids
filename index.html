<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Pieces & Life</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Fredoka', sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(1px 1px at 10% 20%, #fff 50%, transparent 100%),
      radial-gradient(1.5px 1.5px at 30% 60%, #ffd700 50%, transparent 100%),
      radial-gradient(1px 1px at 50% 10%, #fff 50%, transparent 100%),
      radial-gradient(1.2px 1.2px at 70% 40%, #87ceeb 50%, transparent 100%),
      radial-gradient(1px 1px at 90% 80%, #fff 50%, transparent 100%),
      radial-gradient(1.5px 1.5px at 15% 85%, #ffd700 50%, transparent 100%),
      radial-gradient(1px 1px at 45% 45%, #fff 50%, transparent 100%),
      radial-gradient(1.2px 1.2px at 80% 15%, #87ceeb 50%, transparent 100%);
    z-index: 0;
    pointer-events: none;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 24px 20px 60px;
  }

  /* --- Header --- */
  header {
    text-align: center;
    margin-bottom: 12px;
  }
  header h1 {
    font-size: 2.2rem;
    font-weight: 700;
    background: linear-gradient(135deg, #ffd700, #ff6b6b, #4ecdc4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* --- Progress --- */
  .progress {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 28px;
  }
  .prog-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background: #2a2a4a;
    border: 2px solid #4a4a6a;
    transition: all 0.3s;
  }
  .prog-dot.done { background: #4ecdc4; border-color: #4ecdc4; }
  .prog-dot.now  { background: #ffd700; border-color: #ffd700; box-shadow: 0 0 8px rgba(255,215,0,0.5); }

  /* --- Scene card --- */
  .scene-card {
    background: #16213e;
    border: 2px solid #2a2a4a;
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 24px;
    text-align: center;
  }
  .scene-card h2 {
    font-size: 1.3rem;
    color: #ffd700;
    margin-bottom: 14px;
    font-weight: 600;
  }
  .scene-card svg {
    width: 100%;
    max-width: 520px;
    height: auto;
    border-radius: 12px;
  }

  /* --- Piece choices --- */
  .question-text {
    text-align: center;
    font-size: 1.15rem;
    color: #c0c0e0;
    margin-bottom: 16px;
  }

  .pieces-row {
    display: flex;
    justify-content: center;
    gap: 14px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }

  .piece-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: #16213e;
    border: 3px solid #2a2a4a;
    border-radius: 16px;
    padding: 14px 18px 10px;
    cursor: pointer;
    transition: all 0.25s;
    min-width: 90px;
  }
  .piece-btn:hover {
    border-color: #ffd700;
    transform: translateY(-3px);
    box-shadow: 0 4px 15px rgba(255,215,0,0.2);
  }
  .piece-btn .piece-icon {
    font-size: 2.4rem;
    line-height: 1;
  }
  .piece-btn .piece-name {
    font-size: 0.85rem;
    color: #8888aa;
    font-weight: 500;
  }
  .piece-btn.correct {
    border-color: #4ecdc4;
    background: rgba(78,205,196,0.12);
    animation: pop 0.4s ease;
  }
  .piece-btn.wrong {
    border-color: #ff6b6b;
    background: rgba(255,107,107,0.08);
    animation: shake 0.4s ease;
  }
  .piece-btn.disabled {
    pointer-events: none;
    opacity: 0.4;
  }

  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-6px); }
    75% { transform: translateX(6px); }
  }

  /* --- Reveal card (shown after correct answer) --- */
  .reveal-card {
    background: linear-gradient(135deg, #16213e, #1a1a3e);
    border: 2px solid #4ecdc4;
    border-radius: 20px;
    padding: 20px 24px;
    max-width: 700px;
    margin: 0 auto 20px;
    display: flex;
    gap: 20px;
    align-items: center;
    opacity: 0;
    transform: translateY(15px);
    transition: all 0.5s ease;
  }
  .reveal-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Mini board showing the piece's moves */
  .mini-board {
    flex-shrink: 0;
  }
  .mini-board svg {
    width: 140px;
    height: 140px;
  }

  .reveal-text {
    flex: 1;
  }
  .reveal-text .piece-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #ffd700;
    margin-bottom: 4px;
  }
  .reveal-text .move-desc {
    font-size: 0.95rem;
    color: #a0a0c0;
    line-height: 1.5;
  }

  /* --- Next button --- */
  .next-btn {
    display: block;
    margin: 0 auto;
    padding: 12px 36px;
    font-family: 'Fredoka', sans-serif;
    font-size: 1.05rem;
    font-weight: 600;
    color: #1a1a2e;
    background: linear-gradient(135deg, #ffd700, #ffb347);
    border: none;
    border-radius: 50px;
    cursor: pointer;
    opacity: 0;
    transform: translateY(8px);
    transition: all 0.4s ease;
  }
  .next-btn.visible {
    opacity: 1;
    transform: translateY(0);
  }
  .next-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 18px rgba(255,215,0,0.35);
  }

  /* --- Score --- */
  .score-bar {
    text-align: center;
    font-size: 0.9rem;
    color: #6a6a8a;
    margin-bottom: 20px;
  }
  .score-bar span { color: #ffd700; font-weight: 600; }

  /* --- End screen --- */
  .end-screen {
    text-align: center;
    padding: 50px 20px;
    display: none;
  }
  .end-screen.visible { display: block; }
  .end-screen h2 {
    font-size: 2rem;
    background: linear-gradient(135deg, #ffd700, #4ecdc4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 14px;
  }
  .end-screen p {
    font-size: 1.05rem;
    color: #a0a0c0;
    max-width: 480px;
    margin: 0 auto 10px;
    line-height: 1.6;
  }
  .end-screen .piece-recap {
    display: flex;
    justify-content: center;
    gap: 18px;
    flex-wrap: wrap;
    margin: 24px auto;
    max-width: 500px;
  }
  .recap-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .recap-item .r-icon { font-size: 2rem; }
  .recap-item .r-name { font-size: 0.75rem; color: #8888aa; }

  .restart-btn {
    margin-top: 20px;
    padding: 12px 36px;
    font-family: 'Fredoka', sans-serif;
    font-size: 1.05rem;
    font-weight: 600;
    color: #1a1a2e;
    background: linear-gradient(135deg, #4ecdc4, #44b0a8);
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .restart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 18px rgba(78,205,196,0.35);
  }

  /* --- Responsive --- */
  @media (max-width: 600px) {
    header h1 { font-size: 1.6rem; }
    .reveal-card { flex-direction: column; text-align: center; }
    .piece-btn { min-width: 75px; padding: 10px 12px 8px; }
    .piece-btn .piece-icon { font-size: 2rem; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Which Chess Piece?</h1>
  </header>

  <div class="progress" id="progress"></div>

  <div id="gameArea">
    <div class="scene-card">
      <h2 id="sceneTitle"></h2>
      <div id="sceneImg"></div>
    </div>

    <p class="question-text" id="questionText"></p>
    <div class="score-bar" id="scoreBar"></div>

    <div class="pieces-row" id="piecesRow"></div>

    <div class="reveal-card" id="revealCard">
      <div class="mini-board" id="miniBoard"></div>
      <div class="reveal-text">
        <div class="piece-title" id="revealTitle"></div>
        <div class="move-desc" id="revealDesc"></div>
      </div>
    </div>

    <button class="next-btn" id="nextBtn">Next</button>
  </div>

  <div class="end-screen" id="endScreen">
    <h2>You Know the Team!</h2>
    <p>Now you know how every chess piece moves â€” and why each one matters.</p>
    <div class="piece-recap" id="pieceRecap"></div>
    <p>Every piece has a role. Every move counts.</p>
    <button class="restart-btn" id="restartBtn">Play Again</button>
  </div>
</div>

<script>
// ============================================================
//  MINI-BOARD SVG GENERATOR
//  Shows a 5x5 grid with the piece in the center and its
//  legal moves highlighted.
// ============================================================

function miniboardSVG(moves, pieceChar, pieceColor) {
  // moves: array of [dx, dy] offsets from center (center = 2,2)
  const size = 140;
  const cell = size / 5;
  let svg = `<svg viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">`;

  // Draw board
  for (let r = 0; r < 5; r++) {
    for (let c = 0; c < 5; c++) {
      const light = (r + c) % 2 === 0;
      svg += `<rect x="${c*cell}" y="${r*cell}" width="${cell}" height="${cell}" fill="${light ? '#3a3a5c' : '#2a2a4a'}" rx="2"/>`;
    }
  }

  // Draw move highlights
  moves.forEach(([dc, dr]) => {
    const col = 2 + dc;
    const row = 2 + dr;
    if (col >= 0 && col < 5 && row >= 0 && row < 5) {
      svg += `<circle cx="${col*cell + cell/2}" cy="${row*cell + cell/2}" r="${cell*0.3}" fill="${pieceColor}" opacity="0.35"/>`;
      svg += `<circle cx="${col*cell + cell/2}" cy="${row*cell + cell/2}" r="${cell*0.15}" fill="${pieceColor}" opacity="0.7"/>`;
    }
  });

  // Draw piece in center
  svg += `<text x="${2*cell + cell/2}" y="${2*cell + cell/2 + 8}" text-anchor="middle" font-size="22" fill="${pieceColor}">${pieceChar}</text>`;
  svg += `</svg>`;
  return svg;
}

// ============================================================
//  SCENE SVGs â€” life situations that visually match a piece's move
// ============================================================

const sceneSVGs = {
  pawn: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <!-- Sky gradient -->
    <defs><linearGradient id="sky1" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#87CEEB"/><stop offset="1" stop-color="#E1F5FE"/></linearGradient></defs>
    <rect width="520" height="300" fill="url(#sky1)" rx="12"/>
    <rect y="210" width="520" height="90" fill="#66BB6A"/>
    <!-- Path going straight forward -->
    <rect x="230" y="60" width="60" height="155" fill="#A5D6A7" rx="4" opacity="0.5"/>
    <!-- Arrow on path -->
    <line x1="260" y1="200" x2="260" y2="80" stroke="#388E3C" stroke-width="3" stroke-dasharray="8 5"/>
    <polygon points="260,65 250,80 270,80" fill="#388E3C"/>
    <!-- Kid at bottom of path, walking forward with backpack -->
    <circle cx="260" cy="195" r="14" fill="#FFCC80"/>
    <circle cx="255" cy="192" r="2" fill="#333"/>
    <circle cx="265" cy="192" r="2" fill="#333"/>
    <path d="M254 199 Q260 203 266 199" stroke="#333" stroke-width="1.2" fill="none"/>
    <rect x="253" y="209" width="14" height="18" fill="#42A5F5" rx="3"/>
    <rect x="253" y="227" width="6" height="10" fill="#1E88E5" rx="2"/>
    <rect x="261" y="227" width="6" height="10" fill="#1E88E5" rx="2"/>
    <!-- Backpack -->
    <rect x="258" y="211" width="12" height="14" fill="#FF7043" rx="3"/>
    <!-- Footprints behind -->
    <ellipse cx="258" cy="243" rx="4" ry="2" fill="#4CAF50" opacity="0.5"/>
    <ellipse cx="263" cy="252" rx="4" ry="2" fill="#4CAF50" opacity="0.4"/>
    <ellipse cx="257" cy="261" rx="4" ry="2" fill="#4CAF50" opacity="0.3"/>
    <!-- School building at end of path -->
    <rect x="220" y="48" width="80" height="40" fill="#FFECB3" rx="4" stroke="#FFB74D" stroke-width="2"/>
    <rect x="250" y="64" width="20" height="24" fill="#8D6E63" rx="2"/>
    <polygon points="218,48 300,48 260,25" fill="#EF5350"/>
    <rect x="235" y="55" width="10" height="10" fill="#81D4FA" rx="1"/>
    <rect x="270" y="55" width="10" height="10" fill="#81D4FA" rx="1"/>
    <!-- Small text label -->
    <text x="260" y="17" text-anchor="middle" fill="#555" font-size="11" font-family="Fredoka">GOAL</text>
  </svg>`,

  rook: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="sky2" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#90CAF9"/><stop offset="1" stop-color="#E3F2FD"/></linearGradient></defs>
    <rect width="520" height="300" fill="url(#sky2)" rx="12"/>
    <rect y="220" width="520" height="80" fill="#8D6E63"/>
    <!-- Long straight hallway / corridor -->
    <rect x="80" y="80" width="360" height="140" fill="#BCAAA4" rx="4"/>
    <rect x="80" y="80" width="360" height="8" fill="#A1887F"/>
    <!-- Straight lines going left-right -->
    <line x1="100" y1="150" x2="420" y2="150" stroke="#FFD54F" stroke-width="4" stroke-dasharray="12 8"/>
    <!-- Straight line going up-down through a crossing -->
    <line x1="260" y1="90" x2="260" y2="210" stroke="#FFD54F" stroke-width="4" stroke-dasharray="12 8"/>
    <!-- Person in center, arms pointing in 4 straight directions -->
    <circle cx="260" cy="150" r="14" fill="#D7A87E"/>
    <circle cx="255" cy="147" r="2" fill="#333"/>
    <circle cx="265" cy="147" r="2" fill="#333"/>
    <path d="M255 155 Q260 158 265 155" stroke="#333" stroke-width="1.2" fill="none"/>
    <rect x="253" y="164" width="14" height="16" fill="#E91E63" rx="3"/>
    <!-- Arms pointing straight left and right -->
    <line x1="253" y1="170" x2="220" y2="170" stroke="#D7A87E" stroke-width="5" stroke-linecap="round"/>
    <line x1="267" y1="170" x2="300" y2="170" stroke="#D7A87E" stroke-width="5" stroke-linecap="round"/>
    <!-- Arrows at ends of paths -->
    <polygon points="100,150 115,143 115,157" fill="#FFD54F"/>
    <polygon points="420,150 405,143 405,157" fill="#FFD54F"/>
    <polygon points="260,90 253,105 267,105" fill="#FFD54F"/>
    <polygon points="260,210 253,195 267,195" fill="#FFD54F"/>
  </svg>`,

  knight: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="sky3" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#CE93D8"/><stop offset="1" stop-color="#F3E5F5"/></linearGradient></defs>
    <rect width="520" height="300" fill="url(#sky3)" rx="12"/>
    <rect y="220" width="520" height="80" fill="#66BB6A"/>
    <!-- Obstacles (blocks kid can't go through) -->
    <rect x="180" y="130" width="50" height="50" fill="#EF5350" rx="6" opacity="0.7"/>
    <text x="205" y="162" text-anchor="middle" fill="white" font-size="22">X</text>
    <rect x="290" y="130" width="50" height="50" fill="#EF5350" rx="6" opacity="0.7"/>
    <text x="315" y="162" text-anchor="middle" fill="white" font-size="22">X</text>
    <rect x="235" y="70" width="50" height="50" fill="#EF5350" rx="6" opacity="0.7"/>
    <text x="260" y="102" text-anchor="middle" fill="white" font-size="22">X</text>
    <!-- Kid jumping OVER the obstacle in an L-shape path -->
    <!-- Start position -->
    <circle cx="150" cy="200" r="5" fill="#9C27B0" opacity="0.4"/>
    <!-- L-shaped path: up then right -->
    <path d="M150 200 L150 130 L260 130" stroke="#9C27B0" stroke-width="3" stroke-dasharray="6 4" fill="none"/>
    <!-- Kid at landing spot -->
    <circle cx="260" cy="200" r="14" fill="#FFCC80"/>
    <circle cx="255" cy="197" r="2" fill="#333"/>
    <circle cx="265" cy="197" r="2" fill="#333"/>
    <path d="M255 204 Q260 208 265 204" stroke="#333" stroke-width="1.2" fill="none"/>
    <rect x="253" y="214" width="14" height="12" fill="#9C27B0" rx="3"/>
    <!-- Jump arc over obstacles -->
    <path d="M150 195 Q200 100 260 195" stroke="#AB47BC" stroke-width="3" fill="none" stroke-dasharray="5 5"/>
    <!-- Star at landing -->
    <text x="260" y="180" text-anchor="middle" fill="#FFD700" font-size="16">â˜…</text>
    <!-- Friend waiting -->
    <circle cx="370" cy="200" r="12" fill="#D7A87E"/>
    <circle cx="366" cy="197" r="1.5" fill="#333"/>
    <circle cx="374" cy="197" r="1.5" fill="#333"/>
    <path d="M366 203 Q370 207 374 203" stroke="#333" stroke-width="1" fill="none"/>
    <rect x="364" y="212" width="12" height="12" fill="#4CAF50" rx="3"/>
    <!-- Wave hand -->
    <line x1="376" y1="215" x2="390" y2="205" stroke="#D7A87E" stroke-width="4" stroke-linecap="round"/>
  </svg>`,

  bishop: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="sky4" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#80CBC4"/><stop offset="1" stop-color="#E0F2F1"/></linearGradient></defs>
    <rect width="520" height="300" fill="url(#sky4)" rx="12"/>
    <rect y="230" width="520" height="70" fill="#A5D6A7"/>
    <!-- Diagonal paths from center -->
    <line x1="260" y1="150" x2="380" y2="60" stroke="#26A69A" stroke-width="4" stroke-dasharray="8 5"/>
    <line x1="260" y1="150" x2="140" y2="60" stroke="#26A69A" stroke-width="4" stroke-dasharray="8 5"/>
    <line x1="260" y1="150" x2="380" y2="230" stroke="#26A69A" stroke-width="4" stroke-dasharray="8 5"/>
    <line x1="260" y1="150" x2="140" y2="230" stroke="#26A69A" stroke-width="4" stroke-dasharray="8 5"/>
    <!-- Arrow tips -->
    <polygon points="380,60 365,63 370,78" fill="#26A69A"/>
    <polygon points="140,60 155,63 150,78" fill="#26A69A"/>
    <polygon points="380,230 365,227 370,212" fill="#26A69A"/>
    <polygon points="140,230 155,227 150,212" fill="#26A69A"/>
    <!-- Kid in center looking around diagonally -->
    <circle cx="260" cy="142" r="14" fill="#FFCC80"/>
    <circle cx="255" cy="139" r="2" fill="#333"/>
    <circle cx="265" cy="139" r="2" fill="#333"/>
    <path d="M255 147 Q260 150 265 147" stroke="#333" stroke-width="1.2" fill="none"/>
    <rect x="253" y="156" width="14" height="16" fill="#26A69A" rx="3"/>
    <!-- Things at corners â€” goals in 4 diagonal directions -->
    <text x="385" y="55" font-size="20">ðŸ“š</text>
    <text x="120" y="55" font-size="20">ðŸŽ¨</text>
    <text x="385" y="240" font-size="20">âš½</text>
    <text x="120" y="240" font-size="20">ðŸŽµ</text>
  </svg>`,

  queen: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="sky5" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#FFD54F"/><stop offset="1" stop-color="#FFF9C4"/></linearGradient>
    </defs>
    <rect width="520" height="300" fill="url(#sky5)" rx="12"/>
    <rect y="230" width="520" height="70" fill="#A5D6A7"/>
    <!-- ALL directions: straight + diagonal -->
    <!-- Straight lines -->
    <line x1="260" y1="150" x2="260" y2="30" stroke="#F57F17" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="260" y2="260" stroke="#F57F17" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="100" y2="150" stroke="#F57F17" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="420" y2="150" stroke="#F57F17" stroke-width="3" stroke-dasharray="6 4"/>
    <!-- Diagonals -->
    <line x1="260" y1="150" x2="380" y2="40" stroke="#FF8F00" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="140" y2="40" stroke="#FF8F00" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="380" y2="260" stroke="#FF8F00" stroke-width="3" stroke-dasharray="6 4"/>
    <line x1="260" y1="150" x2="140" y2="260" stroke="#FF8F00" stroke-width="3" stroke-dasharray="6 4"/>
    <!-- Kid in center â€” confident, arms wide, crown hint -->
    <circle cx="260" cy="135" r="15" fill="#FFCC80"/>
    <circle cx="254" cy="132" r="2" fill="#333"/>
    <circle cx="266" cy="132" r="2" fill="#333"/>
    <path d="M254 140 Q260 145 266 140" stroke="#333" stroke-width="1.3" fill="none"/>
    <rect x="252" y="150" width="16" height="18" fill="#F57F17" rx="3"/>
    <!-- Arms spread wide -->
    <line x1="252" y1="156" x2="220" y2="145" stroke="#FFCC80" stroke-width="5" stroke-linecap="round"/>
    <line x1="268" y1="156" x2="300" y2="145" stroke="#FFCC80" stroke-width="5" stroke-linecap="round"/>
    <!-- Crown -->
    <polygon points="248,122 252,128 256,120 260,128 264,120 268,128 272,122" fill="#FFD700" stroke="#F57F17" stroke-width="1"/>
    <!-- Arrow tips at all 8 ends -->
    <polygon points="260,30 255,42 265,42" fill="#F57F17"/>
    <polygon points="100,150 112,145 112,155" fill="#F57F17"/>
    <polygon points="420,150 408,145 408,155" fill="#F57F17"/>
    <polygon points="260,260 255,248 265,248" fill="#F57F17"/>
  </svg>`,

  king: `<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="sky6" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#BBDEFB"/><stop offset="1" stop-color="#E3F2FD"/></linearGradient></defs>
    <rect width="520" height="300" fill="url(#sky6)" rx="12"/>
    <rect y="220" width="520" height="80" fill="#A5D6A7"/>
    <!-- Small circle around center â€” king only moves one step -->
    <circle cx="260" cy="150" r="55" fill="none" stroke="#1E88E5" stroke-width="2" stroke-dasharray="6 4" opacity="0.5"/>
    <!-- 8 small dots around the king, one step away in each direction -->
    <circle cx="260" cy="95" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="260" cy="205" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="205" cy="150" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="315" cy="150" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="221" cy="111" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="299" cy="111" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="221" cy="189" r="6" fill="#1E88E5" opacity="0.3"/>
    <circle cx="299" cy="189" r="6" fill="#1E88E5" opacity="0.3"/>
    <!-- Parent figure in center with kids around -->
    <circle cx="260" cy="138" r="16" fill="#8D6E63"/>
    <circle cx="254" cy="135" r="2" fill="#333"/>
    <circle cx="266" cy="135" r="2" fill="#333"/>
    <path d="M254 143 Q260 147 266 143" stroke="#333" stroke-width="1.2" fill="none"/>
    <rect x="252" y="154" width="16" height="20" fill="#1E88E5" rx="3"/>
    <!-- Cross on top (king symbol) -->
    <line x1="260" y1="118" x2="260" y2="126" stroke="#FFD700" stroke-width="3"/>
    <line x1="256" y1="122" x2="264" y2="122" stroke="#FFD700" stroke-width="3"/>
    <!-- Small kids nearby, protected -->
    <circle cx="225" cy="175" r="9" fill="#FFCC80"/>
    <circle cx="222" cy="173" r="1.2" fill="#333"/>
    <circle cx="228" cy="173" r="1.2" fill="#333"/>
    <rect x="220" y="184" width="10" height="10" fill="#FF7043" rx="2"/>
    <circle cx="295" cy="175" r="9" fill="#D7A87E"/>
    <circle cx="292" cy="173" r="1.2" fill="#333"/>
    <circle cx="298" cy="173" r="1.2" fill="#333"/>
    <rect x="290" y="184" width="10" height="10" fill="#AB47BC" rx="2"/>
    <!-- Shields / safe zone feel -->
    <text x="260" y="240" text-anchor="middle" fill="#1565C0" font-size="10" font-family="Fredoka" opacity="0.5">one careful step at a time</text>
  </svg>`,
};

// ============================================================
//  PUZZLE DATA
// ============================================================

const allPieces = [
  { id: 'pawn',   icon: 'â™Ÿ', name: 'Pawn' },
  { id: 'rook',   icon: 'â™œ', name: 'Rook' },
  { id: 'knight', icon: 'â™ž', name: 'Knight' },
  { id: 'bishop', icon: 'â™', name: 'Bishop' },
  { id: 'queen',  icon: 'â™›', name: 'Queen' },
  { id: 'king',   icon: 'â™š', name: 'King' },
];

const puzzles = [
  {
    sceneTitle: "One Step at a Time",
    sceneSVG: sceneSVGs.pawn,
    question: "This kid walks straight ahead, one step at a time. Which piece?",
    answer: "pawn",
    revealTitle: "The Pawn â™Ÿ",
    revealDesc: "Moves forward one square at a time. Can't go backward. On its first move, it can jump two squares ahead!",
    moves: [[0,-1],[0,-2]],
    pieceChar: "â™Ÿ",
    pieceColor: "#42A5F5",
  },
  {
    sceneTitle: "Straight Lines Only",
    sceneSVG: sceneSVGs.rook,
    question: "This kid goes straight â€” left, right, up, or down. As far as they want! Which piece?",
    answer: "rook",
    revealTitle: "The Rook â™œ",
    revealDesc: "Moves in straight lines â€” up, down, left, or right â€” as many squares as it wants. No diagonals!",
    moves: [[0,-1],[0,-2],[0,1],[0,2],[-1,0],[-2,0],[1,0],[2,0]],
    pieceChar: "â™œ",
    pieceColor: "#E91E63",
  },
  {
    sceneTitle: "Jump Over Anything!",
    sceneSVG: sceneSVGs.knight,
    question: "This kid jumps over obstacles in an L-shape to reach their friend. Which piece?",
    answer: "knight",
    revealTitle: "The Knight â™ž",
    revealDesc: "Moves in an L-shape: two squares one way, then one square sideways. It's the only piece that can jump over others!",
    moves: [[-1,-2],[1,-2],[-2,-1],[2,-1],[-1,2],[1,2],[-2,1],[2,1]],
    pieceChar: "â™ž",
    pieceColor: "#AB47BC",
  },
  {
    sceneTitle: "The Diagonal Explorer",
    sceneSVG: sceneSVGs.bishop,
    question: "This kid only moves diagonally â€” cutting across to reach different corners. Which piece?",
    answer: "bishop",
    revealTitle: "The Bishop â™",
    revealDesc: "Moves diagonally as far as it wants. A bishop on white squares stays on white forever!",
    moves: [[-1,-1],[1,-1],[-1,1],[1,1],[-2,-2],[2,-2],[-2,2],[2,2]],
    pieceChar: "â™",
    pieceColor: "#26A69A",
  },
  {
    sceneTitle: "The One Who Can Go Anywhere",
    sceneSVG: sceneSVGs.queen,
    question: "This kid can go in ANY direction â€” straight or diagonal â€” as far as they want. Which piece?",
    answer: "queen",
    revealTitle: "The Queen â™›",
    revealDesc: "The most powerful piece! Moves any number of squares in any direction â€” straight or diagonal.",
    moves: [[0,-1],[0,-2],[0,1],[0,2],[-1,0],[-2,0],[1,0],[2,0],[-1,-1],[1,-1],[-1,1],[1,1],[-2,-2],[2,-2]],
    pieceChar: "â™›",
    pieceColor: "#F57F17",
  },
  {
    sceneTitle: "One Step, But In Any Direction",
    sceneSVG: sceneSVGs.king,
    question: "This parent stays close, moving just one step in any direction to keep everyone safe. Which piece?",
    answer: "king",
    revealTitle: "The King â™š",
    revealDesc: "Moves one square in any direction. The most important piece â€” if it's captured, the game is over!",
    moves: [[0,-1],[0,1],[-1,0],[1,0],[-1,-1],[1,-1],[-1,1],[1,1]],
    pieceChar: "â™š",
    pieceColor: "#1E88E5",
  },
];

// ============================================================
//  GAME STATE
// ============================================================

let current = 0;
let score = 0;
let answered = false;

const $ = (id) => document.getElementById(id);

function renderProgress() {
  const el = $('progress');
  el.innerHTML = '';
  puzzles.forEach((_, i) => {
    const d = document.createElement('div');
    d.className = 'prog-dot' + (i < current ? ' done' : '') + (i === current ? ' now' : '');
    el.appendChild(d);
  });
}

function loadPuzzle() {
  const p = puzzles[current];
  answered = false;
  renderProgress();

  $('sceneTitle').textContent = p.sceneTitle;
  $('sceneImg').innerHTML = p.sceneSVG;
  $('questionText').textContent = p.question;
  $('scoreBar').innerHTML = `Score: <span>${score}</span> / ${puzzles.length}`;

  // Build piece buttons
  const row = $('piecesRow');
  row.innerHTML = '';
  allPieces.forEach(pc => {
    const btn = document.createElement('button');
    btn.className = 'piece-btn';
    btn.innerHTML = `<span class="piece-icon">${pc.icon}</span><span class="piece-name">${pc.name}</span>`;
    btn.addEventListener('click', () => handleChoice(pc.id, btn));
    row.appendChild(btn);
  });

  // Hide reveal & next
  $('revealCard').classList.remove('visible');
  $('nextBtn').classList.remove('visible');
  $('gameArea').style.display = 'block';
  $('endScreen').classList.remove('visible');
}

function handleChoice(pieceId, btnEl) {
  if (answered) return;
  const p = puzzles[current];

  if (pieceId === p.answer) {
    answered = true;
    score++;
    btnEl.classList.add('correct');
    $('scoreBar').innerHTML = `Score: <span>${score}</span> / ${puzzles.length}`;

    // Disable all buttons
    document.querySelectorAll('.piece-btn').forEach(b => {
      if (!b.classList.contains('correct')) b.classList.add('disabled');
    });

    // Show reveal
    $('miniBoard').innerHTML = miniboardSVG(p.moves, p.pieceChar, p.pieceColor);
    $('revealTitle').textContent = p.revealTitle;
    $('revealDesc').textContent = p.revealDesc;

    setTimeout(() => $('revealCard').classList.add('visible'), 300);
    setTimeout(() => {
      $('nextBtn').textContent = current < puzzles.length - 1 ? 'Next' : 'See Results';
      $('nextBtn').classList.add('visible');
    }, 700);
  } else {
    btnEl.classList.add('wrong');
    setTimeout(() => btnEl.classList.remove('wrong'), 400);
    btnEl.classList.add('disabled');
  }
}

$('nextBtn').addEventListener('click', () => {
  current++;
  if (current >= puzzles.length) {
    showEnd();
  } else {
    loadPuzzle();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
});

function showEnd() {
  $('gameArea').style.display = 'none';
  const endEl = $('endScreen');
  endEl.classList.add('visible');

  // Piece recap
  const recap = $('pieceRecap');
  recap.innerHTML = '';
  allPieces.forEach(pc => {
    const item = document.createElement('div');
    item.className = 'recap-item';
    item.innerHTML = `<span class="r-icon">${pc.icon}</span><span class="r-name">${pc.name}</span>`;
    recap.appendChild(item);
  });
}

$('restartBtn').addEventListener('click', () => {
  current = 0;
  score = 0;
  loadPuzzle();
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// --- INIT ---
loadPuzzle();
</script>
</body>
</html>
